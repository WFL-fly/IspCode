/******************************************************************************** app_gain.c** Copyright (C) 2019-2021 ZheJiang Dahua Technology CO.,LTD.** Author : Yan Hongsheng  <yan_hongsheng@dahuatech.com>* Version: V1.0.0  2019-9-1 Create** Desc: ISP能力集管理模块** Modification:*    Date    :*    Revision:*    Author  :*    Contents:*******************************************************************************//* ========================================================================== *//*                             头文件区                                       *//* ========================================================================== */#include "aew.h"/* ========================================================================== *//*                            全局变量定义区                                  *//* ========================================================================== *//* ========================================================================== *//*                          函数声明区                                        *//* ========================================================================== *//* ========================================================================== *//*                          函数定义区                                        *//* ========================================================================== */#ifdef GAIN_MODULEint APP_gainCreate(void){	Int32 ret = OSA_SOK;	Int32 i =0 ;	 /* 在内部参数管理模块创建gain算法所需参数 */    ret = AEW_PARA_CREATE(PARA_AEW_APP_GAIN_PARAMS, APP_GainControl);		APP_GainControl *pa_appGainControl = (APP_GainControl *) AEW_paraGetPtr(PARA_AEW_APP_GAIN_PARAMS);    /*************参数默认化***************/	pa_appGainControl->digitalShift  = 0;	pa_appGainControl->brightness    = 50;   			    pa_appGainControl->gainVal       = 1.0;					pa_appGainControl->blcVal        = 0; 					                                 	pa_appGainControl->dgcOffset     = 0; 					pa_appGainControl->maxSensorGain = 1;				pa_appGainControl->aGainIndex    = 1;     			pa_appGainControl->aGainNum      = 1;    pa_appGainControl->minGain       = 1;    pa_appGainControl->maxGain       = 1;    pa_appGainControl->lastAGian     = 0;    pa_appGainControl->lastDGian     = 0;    for (i=0;i<16;i++)    {        pa_appGainControl->aGainTable[i] = 1.0;    }  		return ret;}int APP_gainInit(void){	Int32 i =0 ;	APP_GainControl *pa_appGainControl = \        (APP_GainControl *)AEW_paraGetPtr(PARA_AEW_APP_GAIN_PARAMS);	ALG_IspParams *pa_algIspParams = \        (ALG_IspParams *)AEW_paraGetPtr(PARA_AEW_ALG_ISP_PARAMS);	ALG_RunModule *pAlgRunModule = \        (ALG_RunModule *)AEW_paraGetPtr(PARA_AEW_ALG_RUN_MODULE_PARAMS);	    /*******固定参数赋值********/    pa_appGainControl->dgcOffset 		= pa_algIspParams->configParams.ispCfgParam.dgcOffset;    pa_appGainControl->minGain          = pa_algIspParams->configParams.ispCfgParam.minGain;    pa_appGainControl->maxGain          = pa_algIspParams->configParams.ispCfgParam.maxGain;    pa_appGainControl->maxSensorGain 	= pa_algIspParams->configParams.sensorCfgParam.maxSensorGain;    pa_appGainControl->aGainNum 		= pa_algIspParams->configParams.sensorCfgParam.aGainNum;    OSA_memCmpSize(pa_appGainControl->aGainTable, pa_algIspParams->configParams.sensorCfgParam.aGainTable, pa_appGainControl->aGainNum * sizeof(float));    /*******外部可变参数赋值********/	pa_appGainControl->digitalShift 	= pa_algIspParams->gainParams.digitalShift;	pa_appGainControl->brightness 		= pa_algIspParams->gainParams.brightness;    pa_appGainControl->gainVal 			= pa_algIspParams->gainParams.gainVal;	pa_appGainControl->blcVal 			= pa_algIspParams->blcParams.blcVal;	/*******内部可变参数赋值********/	pAlgRunModule->ispModule[ALG_ISP_SET_GAIN] = 1;		return OSA_SOK;}int APP_gainRun(void){    APP_GainControl *pa_appGainControl = \        (APP_GainControl *)AEW_paraGetPtr(PARA_AEW_APP_GAIN_PARAMS);	ALG_IspParams *pa_algIspParams = \        (ALG_IspParams *)AEW_paraGetPtr(PARA_AEW_ALG_ISP_PARAMS);	ALG_RunModule *pAlgRunModule = \        (ALG_RunModule *)AEW_paraGetPtr(PARA_AEW_ALG_RUN_MODULE_PARAMS);	/*******判断参数是否更改********/    if( (  pa_appGainControl->digitalShift == pa_algIspParams->gainParams.digitalShift)        &&(pa_appGainControl->brightness   == pa_algIspParams->gainParams.brightness)        &&(pa_appGainControl->gainVal      == pa_algIspParams->gainParams.gainVal)        &&(pa_appGainControl->blcVal       == pa_algIspParams->blcParams.blcVal)        )    {        pAlgRunModule->ispModule[ALG_ISP_SET_GAIN] = 0;        return OSA_SOK;    }	pa_appGainControl->digitalShift 	= pa_algIspParams->gainParams.digitalShift;	pa_appGainControl->brightness 		= pa_algIspParams->gainParams.brightness;    pa_appGainControl->gainVal 			= pa_algIspParams->gainParams.gainVal;	pa_appGainControl->blcVal 			= pa_algIspParams->blcParams.blcVal;    pAlgRunModule->ispModule[ALG_ISP_SET_GAIN] = 1;	return OSA_SOK;}int APP_gainDelete(void){		return OSA_SOK;}#elseint APP_gainCreate(void){	Int32 ret = OSA_SOK;	return ret;}int APP_gainInit(void){	return OSA_SOK;}int APP_gainRun(void){	return OSA_SOK;}int APP_gainDelete(void){	return OSA_SOK;}#endif